@page "/manageusers"
@layout AdminLayout
@inherits ManageUsersBase

<div class="grid grid-cols-1 lg:grid-cols-10 gap-4 mx-5 mt-5">
    <div class=" col-span-7 lg:col-span-3">
        <MudPaper Class="p-6 shadow-lg w-full md:min-h-[300px] lg:min-h-[820px] flex flex-col items-center rounded-[20px]">


            @if (_selectedUser != null && _selectedUser.Any())
            {
                var user = _selectedUser.First();


                <MudStack Spacing="3" Class="w-full">

                    <div class="flex justify-center mt-5">
                        <MudAvatar Size="Size.Large"
                                   Style="width: 150px; height: 150px;">
                            @if (!string.IsNullOrWhiteSpace(user.ProfilePictureBase64))
                            {
                                <MudImage Src="@user.ProfilePictureBase64"
                                          Width="200"
                                          Height="200"
                                          Elevation="5"
                                          Class="rounded-xl"/>
                            }
                            else
                            {
                              
                                <span class="text-6xl font-bold text-white">
                                    @(!string.IsNullOrWhiteSpace(user.FullName) ? user.FullName.Substring(0, 1).ToUpper() : "?")
                                </span>
                            }
                        </MudAvatar>
                    </div>

                    <MudDivider Class="w-full my-2" />


                    <MudGrid Class="w-full mt-4 gap-3">

                        <MudItem xs="12">
                            <MudText>
                                <MudIcon Icon="@Icons.Material.Filled.Person" Class="me-2" />
                                <b>Full Name:</b> @(!string.IsNullOrWhiteSpace(user.FullName) ? user.FullName : "N/A")
                            </MudText>
                        </MudItem>

                        <MudItem xs="12">
                            <MudText>
                                <MudIcon Icon="@Icons.Material.Filled.Phone" Class="me-2" />
                                <b>Phone:</b> @(!string.IsNullOrWhiteSpace(user.PhoneNumber) ? user.PhoneNumber : "N/A")
                            </MudText>
                        </MudItem>

                        <MudItem xs="12">
                            <MudText>
                                <MudIcon Icon="@Icons.Material.Filled.Email" Class="me-2" />
                                <b>Email:</b> @(!string.IsNullOrWhiteSpace(user.Email) ? user.Email : "N/A")
                            </MudText>
                        </MudItem>

                        <MudItem xs="12">
                            <MudText>
                                <MudIcon Icon="@Icons.Material.Filled.Wc" Class="me-2" />
                                <b>Gender:</b> @(!string.IsNullOrWhiteSpace(user.Gender) ? user.Gender : "N/A")
                            </MudText>
                        </MudItem>

                        <MudItem xs="12">
                            <MudText>
                                <MudIcon Icon="@Icons.Material.Filled.Home" Class="me-2" />
                                <b>Address:</b> @(!string.IsNullOrWhiteSpace(user.Address) ? user.Address : "N/A")
                            </MudText>
                        </MudItem>

                        <MudItem xs="12">
                            <MudText>
                                <MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" Class="me-2" />
                                <b>Role:</b> @(!string.IsNullOrWhiteSpace(user.Role) ? user.Role : "N/A")
                            </MudText>
                        </MudItem>

                    </MudGrid>

                </MudStack>
            }
            else
            {
                <MudText Typo="Typo.subtitle2" Class="text-center text-blue-500 font-bold mt-6">
                    Select user to display information
                </MudText>
            }

        </MudPaper>
    </div>
  
    <div class="col-span-7 " >
        <MudPaper Class="d-flex flex-wrap flex-row justify-content-between flex-grow-1 gap-4 mb-1 py-2  mud-theme-lighter shadow-lg" Elevation="4">
            <MudItem xs="12" sm="6" md="5" Class="mx-2 ">
                <MudTextField T="string"
                              Label="Search"
                              Variant="Variant.Outlined"
                              AdornmentIcon="@Icons.Material.Filled.Search" />
            </MudItem>

            <MudItem xs="12" sm="6" md="5" Class="d-flex justify-end gap-2 mx-4 mt-2">
                <MudButton Class="mb-3"
                           @onclick="OpenDialogAsync"
                           Variant="Variant.Filled" 
                           Color="Color.Dark"
                           StartIcon="@Icons.Material.Filled.PersonAdd">
                    Add User
                </MudButton>

                <MudButton Class="mb-3"
                           Variant="Variant.Filled"
                           Color="Color.Error"
                           Disabled="@(!_selectedUser.Any())"
                           StartIcon="@Icons.Material.Filled.Delete"
                           OnClick="DeleteSelectedUsersAsync">
                    DELETE (@_selectedUser.Count)
                </MudButton>
            </MudItem>
        </MudPaper>

        <MudPaper Elevation="4" Height="auto" Class="mud-theme-lighter pa-2 pa-lg-2 w-full shadow-lg py-lg-8 mt-2">

            <MudDataGrid T="UserDTO"
                         Items="@users"
                         SortMode="@_sortMode"
                         @bind-SelectedItems="_selectedUser"
                         MultiSelection="true"
                         Dense="true"
                         Striped="true"
                         Class="mt-4">

                <Columns>
                    <SelectColumn T="UserDTO" />
                    <PropertyColumn Property="a => a.FullName" Title="Full Name" />
                    <PropertyColumn Property="a => a.PhoneNumber" Title="Phone Number" />
                    <PropertyColumn Property="a => a.Email" Title="Email" />
                    <PropertyColumn Property="a => a.Gender" Title="Gender" />
                    <PropertyColumn Property="a => a.Address" Title="Address" />


                    <TemplateColumn Title="Actions">
                        <CellTemplate>
                            <MudIconButton Icon="@Icons.Material.Outlined.Edit"
                                           Variant="Variant.Filled"
                                           Color="Color.Dark"
                                           Size="Size.Small"
                                           @onclick="() => OpenEditDialog(context.Item.UserId)" />
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>

                <PagerContent>
                    <MudDataGridPager T="UserDTO" />
                </PagerContent>
            </MudDataGrid>
        </MudPaper>
    </div>
</div>

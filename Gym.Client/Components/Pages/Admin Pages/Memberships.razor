@page "/memberships"
@layout AdminLayout
@inherits MembershipsBase


<MudContainer Fixed="true" Class="mt-4">
    <MudPaper Class="d-flex flex-wrap  align-center flex-grow-1 gap-4" Elevation="0">
        <MudText Typo="Typo.h6"><strong> Memberships List</strong></MudText>
        <MudItem xs="12" sm="6" md="1" lg="3">
            <MudTextField T="string"
                          Label="Search"
                          Variant="Variant.Outlined"
                          Adornment="Adornment.End"
                          AdornmentIcon="@Icons.Material.Filled.Search"
                          Class="w-100" />
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
        <MudSelect @bind-Value="selectedStatus" Label="Select Status" Variant="Variant.Outlined">
             <MudSelectItem Value="@("Pending")">Pending</MudSelectItem>
            <MudSelectItem Value="@( "Accepted" )">Accepted</MudSelectItem>
            <MudSelectItem Value="@( "Rejected" )">Rejected</MudSelectItem>
             
           
        </MudSelect>
        </MudItem>

       <MudItem xs="12" sm="6" md="3" Class="my-2 d-flex justify-center">
        <MudButton Color="Color.Primary" Variant="Variant.Filled"
                   Disabled="@(!selectedMembers.Any() || string.IsNullOrEmpty(selectedStatus))"
                   OnClick="() => UpdateSelectedStatusAsync(selectedStatus)">
            Apply Status
        </MudButton>
        </MudItem>
    </MudPaper>

    <MudDataGrid  T="MembershipDTO" Items="@members" SortMode="@_sortMode"
                 Selection="DataGridSelection.Multiple"
                 ShowCheckbox="true"
                 @bind-SelectedItems="selectedMembers">
        <Columns>
            <PropertyColumn Property="m => m.MemberID" Title="Member ID" Sortable="false" />
            <PropertyColumn Property="m => m.FullName" Title="Full Name" />
            <PropertyColumn Property="m => m.Email" Title="Email" />
            <PropertyColumn Property="m => m.PhoneNumber" Title="Phone Number" />
            <PropertyColumn Property="m => m.AppliedDate" Title="Applied Date"
                            CellClass="text-nowrap"
                            TextAlign="Align.Left"
                            Format="dd/MM/yyyy" />
            <PropertyColumn Property="a => a.Status" Title="Status" />

            <TemplateColumn Title="QR Code">
                <CellTemplate Context="context">
                    @if (!string.IsNullOrEmpty(context.Item.QRCode))
                    {
                        <img src="data:image/png;base64,@context.Item.QRCode" alt="QR Code"
                             style="width:80px; height:80px;" />
                    }
                    else
                    {
                        <MudText Color="Color.Error" Typo="Typo.caption">No QR</MudText>
                    }
                </CellTemplate>
            </TemplateColumn>

        </Columns>

        <PagerContent>
            <MudDataGridPager T="MembershipDTO" />
        </PagerContent>
    </MudDataGrid>
</MudContainer>

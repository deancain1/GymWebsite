@page "/memberships"
@layout AdminLayout
@inherits MembershipsBase


<div class="mx-5 mt-3 ">
    <MudPaper Class="d-flex flex-wrap  align-center px-5 flex-grow-1 gap-2 py-2 " Elevation="1">
        <MudText Typo="Typo.h6"><strong> Memberships List</strong></MudText>
        <MudItem xs="12" sm="6" md="1" lg="3">
            <MudTextField T="string"
                          Label="Search"
                          Variant="Variant.Outlined"
                          Adornment="Adornment.End"
                          AdornmentIcon="@Icons.Material.Filled.Search"
                          Class="w-100" />
        </MudItem>

        <MudItem xs="12" sm="6" md="3">
        <MudSelect @bind-Value="selectedStatus" Label="Select Status" Variant="Variant.Outlined">
            <MudSelectItem Value="@("Pending")">Pending</MudSelectItem>
            <MudSelectItem Value="@( "Accepted" )">Accepted</MudSelectItem>
            <MudSelectItem Value="@( "Rejected" )">Rejected</MudSelectItem>
             
           
        </MudSelect>
        </MudItem>

       <MudItem  md="4" Class="flex flex-row gap-2 ">
            <MudButton Color="Color.Info" Size="Size.Small"  Variant="Variant.Filled" Disabled="@(!selectedMembers.Any() || string.IsNullOrEmpty(selectedStatus))"
                       OnClick="() => UpdateSelectedStatusAsync(selectedStatus)"> Apply Status
        </MudButton>

            <MudButton Color="Color.Default" Size="Size.Small"  Variant="Variant.Filled" Disabled="@(!selectedMembers.Any())" OnClick="GenerateSelectedPdfsAsync">
                Generate Card
            </MudButton>

            <MudButton Variant="Variant.Filled" Size="Size.Small"  Color="Color.Error" Disabled="@(!selectedMembers.Any())" StartIcon="@Icons.Material.Filled.Delete"
                       OnClick="DeleteSelectedMembersAsync"> Delete Member  (@selectedMembers.Count)
            </MudButton>
        </MudItem>

        <MudPaper Class="w-full ">
            <MudDataGrid T="MembershipDTO" Items="@members" SortMode="@_sortMode" MultiSelection="true" Dense="true"
                          @bind-SelectedItems="selectedMembers">

                <Columns>
                    <SelectColumn T="MembershipDTO" />

                    <PropertyColumn Property="m => m.FullName" Title="Full Name">
                        <CellTemplate>
                            <MudIcon Icon="@Icons.Material.Filled.AccountCircle" Style="color: gray;" Size="Size.Small" />
                            <MudChip Variant="Variant.Text"  Size="Size.Small">@context.Item.FullName</MudChip>
                        </CellTemplate>
                    </PropertyColumn>

                    <PropertyColumn Property="m => m.Email" Title="Email" >
                        <CellTemplate>
                            <MudIcon Icon="@Icons.Material.Filled.Email" Style="color: gray;" Size="Size.Small" />
                            <MudChip Variant="Variant.Text"  Size="Size.Small">@context.Item.Email</MudChip>
                        </CellTemplate>
                    </PropertyColumn>

                    <PropertyColumn Property="m => m.PhoneNumber" Title="Phone Number" >
                        <CellTemplate>
                            <MudIcon Icon="@Icons.Material.Filled.Phone" Style="color: gray;" Size="Size.Small" />
                            <MudChip Variant="Variant.Text"  Size="Size.Small">@context.Item.PhoneNumber</MudChip>
                        </CellTemplate>
                    </PropertyColumn>

                    <PropertyColumn Property="m => m.AppliedDate" Title="Applied Date" CellClass="text-nowrap" Format="dd/MM/yyyy" >
                        <CellTemplate>
                            <MudIcon Icon="@Icons.Material.Filled.CalendarToday" Style="color: gray;" Size="Size.Small" />
                            <MudChip Variant="Variant.Text"  Size="Size.Small">@context.Item.AppliedDate.ToString("dd/MM/yyyy")</MudChip>
                        </CellTemplate>
                    </PropertyColumn>

                    <PropertyColumn Property="a => a.Status" Title="Status" >
                        <CellTemplate>
                            <MudIcon Icon="@Icons.Material.Filled.Info" Style="color: gray" Size="Size.Small" />
                            <MudChip Variant="Variant.Text" Size="Size.Small">@context.Item.Status</MudChip>
                        </CellTemplate>
                    </PropertyColumn>

                    <TemplateColumn Title="QR Code">
                        <CellTemplate Context="context">
                            @if (!string.IsNullOrEmpty(context.Item.QRCode))
                            {
                                <img src="data:image/png;base64,@context.Item.QRCode" alt="QR Code"
                                     style="width:80px; height:80px;" />
                            }
                            else
                            {
                                <MudText Color="Color.Error" Typo="Typo.caption">No QR</MudText>
                            }
                        </CellTemplate>
                    </TemplateColumn>

                </Columns>

                <PagerContent>
                    <MudDataGridPager T="MembershipDTO" />
                </PagerContent>
            </MudDataGrid>
        </MudPaper>
    </MudPaper>

    
</div>
